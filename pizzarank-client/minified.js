var mod=angular.module("user",["ngRoute"])
mod.factory("User",["$http","$rootScope","authManager",function(t,e,r){return{create:function(e,r,a){var n=this
t.post("/api/users/users",e).then(function(t){n.loginResult(t,r)},function(t){a(t)})},loginResult:function(t,e){localStorage.setItem("id_token",t.data.token),localStorage.setItem("user",t.data.user),r.authenticate(),e(t.data.user)},logout:function(){localStorage.removeItem("id_token"),localStorage.removeItem("user"),r.unauthenticate()},getCurrentUser:function(){return localStorage.getItem("user")}}}])
var mod=angular.module("user")
mod.component("loginForm",{bindings:{email:"=",password:"="},require:{},transclude:!0,templateUrl:"user/login.html",controller:["$scope","LoginForm",function(t,e){t.email="Email@address.com",t.password="",t.submit=function(){e.login(t.email,t.password)}}]}),mod.service("LoginForm",["$http","authManager","User",function(t,e,r){return{login:function(e,a){t.post("/api/users/login",{email:e,password:a}).then(r.processLoginResult,function(t){alert(t)})}}}])
var mod=angular.module("user")
mod.component("registerForm",{templateUrl:"user/register-form.html",controller:["$scope","RegisterForm",function(t,e){t.submit=function(){e.save({first_name:t.first_name,last_name:t.last_name,email:t.email,password:t.password})}}]}),mod.service("RegisterForm",["$http","User",function(t,e){return{save:function(t){e.create(t,function(t){},function(t){})}}}])
var mod=angular.module("restaurant",["ngResource","ngRoute"])
mod.factory("Restaurant",["$resource",function(t){return t("/api/restaurants/restaurants/:slug",{},{query:{method:"GET",isArray:!0}})}]),mod.factory("Rating",["$resource",function(t){return t("/api/restaurants/ratings/:id",{},{create:{method:"POST"}})}]),mod.controller("SearchCtrl",["$scope","$http","$location",function(t,e,r){t.getRestaurants=function(t){return e.get("/api/restaurants/restaurantsearch",{params:{name:t}}).then(function(t){return t.data})},t.onSelect=function(t,e,a){r.path("/restaurant/"+t.slug),console.log(t)}}])
var mod=angular.module("restaurant")
mod.component("restaurantDetail",{transclude:!0,templateUrl:"restaurant/restaurant-detail.html",controller:["$routeParams","$scope","Restaurant",function(t,e,r){var a=this
a.restaurant=r.get({slug:t.restaurant_slug}),this.getRestaurant=function(){return a.restaurant}}]})
var mod=angular.module("restaurant")
mod.component("restaurantList",{templateUrl:"restaurant/restaurant-list.html",controller:["$routeParams","$scope","Restaurant",function(t,e,r){this.restaurants=r.query()}]})
var mod=angular.module("restaurant")
mod.component("restaurantRatingForm",{bindings:{title:"=",body:"=",rating:"="},require:{resCtrl:"^restaurantDetail"},transclude:!0,templateUrl:"restaurant/restaurant-rating-form.html",controller:["$scope","RatingForm",function(t,e){t.title="Enter title",t.body="Write your review",t.rating=0,t.submit=function(){e.save(this.$ctrl.resCtrl.restaurant._id,{title:t.title,body:t.body,rating:t.rating})}}]}),mod.service("RatingForm",["$http","Rating",function(t,e){return{save:function(t,r){e.create({id:t},r)}}}]),angular.module("pizzarankApp",["ngRoute","restaurant","user","ui.bootstrap","angular-jwt","ui.validate"]).config(["$locationProvider","$routeProvider","$httpProvider","jwtOptionsProvider",function(t,e,r,a){t.hashPrefix("!"),e.when("/home",{templateUrl:"home.html"}).when("/restaurants",{template:"<restaurant-list></restaurant-list>"}).when("/restaurant/:restaurant_slug",{template:"<restaurant-detail></restaurant-detail>"}).when("/b/:borough",{template:'<restaurant-list borough="$borough"></restaurant-list>'}).when("/profile/:user_id",{template:"<profile></profile>"}).when("/register",{template:"<register-form></register-form>"}).otherwise("/home"),a.config({authPrefix:"JWT ",tokenGetter:function(){return localStorage.getItem("id_token")}}),r.interceptors.push("jwtInterceptor")}]),angular.module("pizzarankApp").run(["authManager",function(t){t.checkAuthOnRefresh()}])
